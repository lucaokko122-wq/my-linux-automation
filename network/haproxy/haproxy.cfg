global
    daemon
    maxconn 4000
    log /dev/log local0 info
    user haproxy
    group haproxy

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    log global
    option httplog
    option dontlognull
    retries 3

# Frontend - HTTP
frontend http_front
    bind *:80
    stats uri /haproxy?stats
    default_backend http_back

# Frontend - HTTPS  
frontend https_front
    bind *:443
    default_backend http_back

# Backend - Web Servers
backend http_back
    balance roundrobin
    option forwardfor
    option httpchk GET /health
    server web1 192.168.1.10:80 check maxconn 300
    server web2 192.168.1.11:80 check maxconn 300
    server web3 192.168.1.12:80 check maxconn 300

# Backend - API Servers
backend api_back
    balance leastconn
    server api1 192.168.1.20:8080 check
    server api2 192.168.1.21:8080 check

# Stats page
listen stats
    bind *:1936
    stats enable
    stats uri /
    stats hide-version
    stats auth admin:password123
